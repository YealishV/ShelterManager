<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ShelterManager ‚Äî prototyp</title>
  <style>
    :root{--bg:#0f1113;--card:#141617;--muted:#bdbdbd;--accent:#b86b4b;--good:#6bb86b;--danger:#b86b6b}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    body{margin:0;background:linear-gradient(180deg,#0b0c0d 0%,#111214 100%);color:#eaeaea}
    header{padding:18px 22px;border-bottom:1px solid rgba(255,255,255,.04);display:flex;align-items:center;gap:16px}
    header h1{font-size:18px;margin:0;font-weight:600;letter-spacing:.4px}
    .wrap{display:grid;grid-template-columns:320px 1fr 360px;gap:18px;padding:18px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,8,.6);border:1px solid rgba(255,255,255,.03)}
    .panel-title{font-size:13px;color:var(--muted);margin-bottom:8px}
    .stats{display:flex;flex-direction:column;gap:8px}
    .stat{display:flex;justify-content:space-between;align-items:center;padding:8px;background:rgba(255,255,255,0.01);border-radius:8px}
    .stat strong{font-size:16px}
    .list{display:flex;flex-direction:column;gap:8px;max-height:62vh;overflow:auto;padding-right:6px}
    .animal{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;background:linear-gradient(180deg,rgba(0,0,0,0.15),rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.02)}
    .avatar{width:68px;height:52px;background:#222;border-radius:8px;flex-shrink:0;display:grid;place-items:center;color:var(--muted);font-size:12px}
    .ainfo{flex:1}
    .ainfo h3{margin:0;font-size:14px}
    .tag{font-size:12px;color:var(--muted)}
    button{background:var(--accent);border:none;padding:8px 10px;border-radius:8px;color:#111;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}
    .center{display:flex;gap:8px;align-items:center}
    .log{font-family:monospace;font-size:13px;color:var(--muted);background:rgba(0,0,0,0.12);padding:10px;border-radius:8px;max-height:46vh;overflow:auto}
    .bigcard{padding:16px}
    .row{display:flex;gap:8px;align-items:center}
    .meter{height:10px;background:rgba(255,255,255,0.04);border-radius:8px;overflow:hidden}
    .meter > i{display:block;height:100%}
    .applicant{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent)}
    footer{padding:12px;text-align:center;color:var(--muted);font-size:13px}
    .muted{color:var(--muted)}
    .applicant-card ul {
  list-style: none;
  padding: 0;
  margin-top: 6px;
}
.applicant-card li {
  font-size: 14px;
  margin-bottom: 3px;
}

    /* responsive */
    @media(max-width:1000px){.wrap{grid-template-columns:1fr;}}
    
  </style>
</head>
<body>
  <header>
    <h1>ShelterManager ‚Äî prototyp</h1>
    <div class="muted">realistyczne zarzƒÖdzanie schroniskiem ‚Ä¢ tryb demo</div>
  </header>

  <main class="wrap">
    <!-- left: overview -->
    <section class="card">
      <div class="panel-title">Dane schroniska</div>
      <div class="stats">
        <div class="stat"><span>Bud≈ºet</span><strong id="budget">2000 z≈Ç</strong></div>
        <div class="stat"><span>Poziom reputacji</span><strong id="rep">50</strong></div>
        <div class="stat"><span>Ilo≈õƒá zwierzƒÖt</span><strong id="count">0</strong></div>
        <div class="stat"><span>Dzie≈Ñ</span><strong id="day">1</strong></div>
      </div>

      <hr style="margin:12px 0;border:0;border-top:1px solid rgba(255,255,255,0.03)">
      <div class="panel-title">Mo≈ºliwe akcje</div>
      <div class="row" style="margin-top:8px">
        <button id="nextDay">Przejd≈∫ dzie≈Ñ</button>
        <button id="callRescue" class="ghost">Wezwij zg≈Çoszenie</button>
      </div>

      <hr style="margin:12px 0;border:0;border-top:1px solid rgba(255,255,255,0.03)">
      <div class="panel-title">Log operacji</div>
      <div class="log" id="log"></div>
    </section>

    <!-- center: animals & actions -->
    <section class="card bigcard">
      <div style="display:flex;justify-content:space-between;align-items:end">
        <div>
          <div class="panel-title">Zwierzƒôta czekajƒÖce na opiekƒô</div>
          <div class="muted" style="font-size:13px;margin-bottom:8px">Kliknij "Przyjmij" by dodaƒá do schroniska, potem lecz / przygotuj do adopcji</div>
        </div>
        <div class="muted">Styl: mroczny realistyczny</div>
      </div>

      <div class="list" id="animalList"></div>

      <hr style="margin:12px 0;border:0;border-top:1px solid rgba(255,255,255,0.03)">

      <div>
        <div class="panel-title">Szczeg√≥≈Çy zwierzaka</div>
        <div id="detail" class="muted">Wybierz zwierzaka z listy po lewej</div>
      </div>
    </section>

    <!-- right: applicants & stats -->
    <section class="card">
      <div class="panel-title">Aplikanci/adopcje</div>
      <div id="appList" style="display:flex;flex-direction:column;gap:8px;margin-top:8px"></div>

      <hr style="margin:12px 0;border:0;border-top:1px solid rgba(255,255,255,0.03)">
      <div class="panel-title">Szybkie wska≈∫niki</div>
      <div class="muted" style="font-size:13px;margin-bottom:8px">Monitoruj poziom zdrowia i wymagania adopcyjne</div>
      <div class="row" style="margin-top:6px">
        <div style="flex:1">
          <div class="tag">≈örednie zdrowie</div>
          <div class="meter" style="margin-top:6px"><i id="avgHealth" style="width:40%;background:var(--good)"></i></div>
        </div>
      </div>
    </section>
  </main>

  <footer>Prototyp wygenerowany ‚Äî zapisz plik jako .html i otw√≥rz w przeglƒÖdarce. Nie potrzebujesz uprawnie≈Ñ administratora.</footer>

<script>
(function(){
/* === zapisywanie i ≈Çadowanie gry (localStorage) === */

  
  // ----- data models -----
  const animals = [];
  const applicants = [];
  let day = 1;
  let budget = 2000;
  let reputation = 50;

  // utility
  function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}
  function log(msg){const el=document.getElementById('log');el.innerHTML=new Date().toLocaleTimeString()+" ‚Äî "+msg+"<br>"+el.innerHTML}

  // sample reasons / states (more realistic)
  const conditions = [
    {code:'uraz',label:'Uraz (z≈Çamanie/ranienie)',sev:70,cost:600},
    {code:'choroba',label:'Choroba zaka≈∫na',sev:60,cost:450},
    {code:'wychudzenie',label:'Wychudzenie / odwodnienie',sev:40,cost:200},
    {code:'pchly',label:'Paso≈ºyty (pch≈Çy/kleszcze)',sev:20,cost:80},
    {code:'stres',label:'Silny stres/trauma',sev:30,cost:120}
  ];

  const names = ['Rysio','Luna','Fado','Mela','Koko','Beren','Saba','Tomek','Nora','Pucio'];

  function createRandomCall(){
    const cond = conditions[randInt(0,conditions.length-1)];
    return {
      id:Date.now()+"_"+Math.random().toString(36).slice(2,7),
      name: names[randInt(0,names.length-1)],
      species: Math.random()<0.7?'pies':'kot',
      condition: cond.label,
      severity: Math.max(10, cond.sev + randInt(-15,15)),
      baseCost: cond.cost,
      health: Math.max(10,100-cond.sev + randInt(-10,10)),
      age: randInt(1,12),
      photo: null
    }
  }

  function pushNewCall(){
    const a = createRandomCall();
    animals.push(a);
    renderAnimals();
    log('Nowe zg≈Çoszenie: '+a.name+' ‚Äî '+a.condition+' ('+a.species+')');
  }

  // applicants generator
   // generator aplikant√≥w
function genApplicantFor(animal) {
  function randomFrom(array) {
    return array[Math.floor(Math.random() * array.length)];
  }

  const applicant = {
    id: 'app_' + Math.random().toString(36).slice(2, 6),
    name: randomFrom(['Anna', 'Kasia', 'Ewa', 'Marta', 'Jan', 'Tomek', 'Ola', 'Karol', 'Magda', 'Piotr']),
    hasChildren: Math.random() < 0.5 ? "Tak" : "Nie",
    petPreference: randomFrom(["Spokojny", "Aktywny", "Towarzyski", "Samotnik"]),
    hasSecuredBalcony: Math.random() < 0.5 ? "Tak" : "Nie",
    timeForPet: randomFrom(["Ma≈Ço", "≈örednio", "Du≈ºo"]),
    hasStableIncome: Math.random() < 0.7 ? "Tak" : "Nie",
    homeSize: randomFrom(["Kawalerka (30m¬≤)", "Mieszkanie (60m¬≤)", "Dom (120m¬≤)"]),
    hasGarden: Math.random() < 0.4 ? "Tak" : "Nie",
    personality: randomFrom(["Cierpliwa", "Nerwowa", "Opieku≈Ñcza", "Zorganizowana", "Chaotyczna"]),
    hasEquipment: randomFrom(["Pe≈Çne wyposa≈ºenie", "Brakuje czƒô≈õci akcesori√≥w", "Nieprzygotowany"]),
    score: randInt(30, 100)
  };
  return applicant;
}

  // rendering
  function renderAnimals(){
    const list = document.getElementById('animalList'); list.innerHTML='';
    animals.forEach(a=>{
      const el=document.createElement('div'); el.className='animal';
      el.innerHTML = `
        <div class="avatar">${a.species.toUpperCase()}</div>
        <div class="ainfo">
          <h3>${a.name} <span class="tag">(${a.species}, ${a.age} lat)</span></h3>
          <div class="muted">${a.condition} ‚Ä¢ zdrowie: ${a.health}% ‚Ä¢ koszt leczenia: ${a.baseCost} z≈Ç</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px">
          <button onclick="takeIn('${a.id}')">Przyjmij</button>
        </div>`;
      list.appendChild(el);
    })
    document.getElementById('count').innerText = animals.length;
    updateAvgHealthBar();
  }

  window.takeIn = function(id){
    const idx = animals.findIndex(x=>x.id==id);
    if(idx<0) return;
    const a = animals[idx];
    // mark as in-shelter by adding 'inShelter'
    a.inShelter = true;
    a.treated = false;
    log('Przyjƒôto do schroniska: '+a.name+' ‚Ä¢ '+a.condition);
    // generate applicants for future adoption
    applicants.push(genApplicantFor(a));
    renderApplicants();
    renderDetail(a);
    renderAnimals();
  }

function renderApplicants() {
  const el = document.getElementById('appList');
  el.innerHTML = '';
  applicants.forEach(app => {
    const node = document.createElement('div');
    node.className = 'applicant-card';
    node.innerHTML = `
      <h3>${app.name}</h3>
      <ul>
        <li><b>Dzieci:</b> ${app.hasChildren}</li>
        <li><b>Charakter zwierzaka:</b> ${app.petPreference}</li>
        <li><b>Zabezpieczony balkon:</b> ${app.hasSecuredBalcony}</li>
        <li><b>Czas dla zwierzaka:</b> ${app.timeForPet}</li>
        <li><b>Sta≈Çy doch√≥d:</b> ${app.hasStableIncome}</li>
        <li><b>Wielko≈õƒá mieszkania:</b> ${app.homeSize}</li>
        <li><b>Ogr√≥dek:</b> ${app.hasGarden}</li>
        <li><b>Charakter:</b> ${app.personality}</li>
        <li><b>Wyposa≈ºenie:</b> ${app.hasEquipment}</li>
      </ul>
      <div style="display:flex;gap:6px;margin-top:6px;">
        <button class='ghost' onclick="rejectApplicant('${app.id}')">Odrzuƒá</button>
        <button onclick="approveApplicant('${app.id}')">Sprawd≈∫ & zdecyduj</button>
      </div>
    `;
    el.appendChild(node);
  });
}


  window.rejectApplicant = function(id){
    const i=applicants.findIndex(x=>x.id==id); if(i<0) return; const a=applicants.splice(i,1)[0];
    log('Odrzucono aplikanta: '+a.name);
    renderApplicants();
  }

  window.approveApplicant = function(id){
    const app = applicants.find(x=>x.id==id); if(!app) return;
    // show modal-like detail in detail panel
    const detail = document.getElementById('detail');
    detail.innerHTML = `<div style='display:flex;gap:12px;align-items:flex-start'>
      <div style='flex:1'>
        <div class='panel-title'>Wybierz zwierzƒô do adopcji lub przypisz aplikanta</div>
        <div class='muted'>Wybierz zwierzƒô z listy i podejmij decyzjƒô. Zwr√≥ƒá uwagƒô na zgodno≈õƒá warunk√≥w.</div>
        <div style='margin-top:8px' id='chooseForApp'></div>
      </div>
    </div>`;

    const choose = document.getElementById('chooseForApp');
    const inShelter = animals.filter(x=>x.inShelter && !x.adopted);
    if(inShelter.length===0){ choose.innerHTML='<div class="muted">Brak dostƒôpnych zwierzƒÖt.</div>'; return; }
    inShelter.forEach(an=>{
      const but=document.createElement('div'); but.className='animal';
      but.style.marginBottom='6px';
      but.innerHTML = `<div class='avatar'>${an.species}</div><div class='ainfo'><h3>${an.name} <span class='tag'>(${an.health}%)</span></h3><div class='muted'>${an.condition} ‚Ä¢ koszt leczenia: ${an.baseCost} z≈Ç</div></div><div><button onclick="finalizeAdopt('${app.id}','${an.id}')">Przypisz & zdecyduj</button></div>`;
      choose.appendChild(but);
    })
  }

  window.finalizeAdopt = function(appId, animalId){
    const app = applicants.find(x=>x.id==appId); const an = animals.find(x=>x.id==animalId);
    if(!app || !an) return;
    // simple evaluation: if their score > threshold and animal health > threshold
    const needed = an.health>50 ? 40 : 70; // je≈õli animal s≈Çaby, potrzebujemy lepszego domu
    let outcome=false; let note='';

    if(app.score>=needed && app.hasYard !== false){ outcome=true; note='Adopcja zaakceptowana'; }
    else { outcome=false; note='Adopcja odrzucona ze wzglƒôd√≥w bezpiecze≈Ñstwa'; }

    if(outcome){ an.adopted=true; an.inShelter=false; reputation += 5; budget += 150; log(`Zwierzƒô ${an.name} adoptowane przez ${app.name} ‚Äî +150 z≈Ç, +5 reputacji`); }
    else { reputation -= 5; log(`Odrzucono adopcjƒô ${an.name} przez ${app.name} ‚Äî -5 reputacji`); }

    // remove applicant
    const idx=applicants.findIndex(x=>x.id==appId); if(idx>=0) applicants.splice(idx,1);
    renderAnimals(); renderApplicants(); updateUI(); document.getElementById('detail').innerText = note;
  }

  function renderDetail(a){
    const el = document.getElementById('detail');
    el.innerHTML = `
      <div style='display:flex;gap:12px;align-items:flex-start'>
        <div style='flex:0 0 120px'><div class='avatar' style='width:120px;height:90px;font-size:20px'>${a.species}</div></div>
        <div style='flex:1'>
          <h3>${a.name} <span class='tag'>(${a.age} lat)</span></h3>
          <div class='muted'>${a.condition} ‚Ä¢ zdrowie: ${a.health}%</div>
          <div style='margin-top:8px;display:flex;gap:8px'>
            <button onclick="treatAnimal('${a.id}')">Leczyƒá (${a.baseCost} z≈Ç)</button>
            <button class='ghost' onclick="markForAdoption('${a.id}')">Przygotuj do adopcji</button>
          </div>
        </div>
      </div>
    `;
  }

  window.treatAnimal = function(id){
    const a = animals.find(x=>x.id==id); if(!a) return;
    if(budget < a.baseCost){ log('Za ma≈Ço ≈õrodk√≥w na leczenie.'); return; }
    budget -= a.baseCost;
    // treatment: success depends on severity and random
    const chance = Math.max(20, 100 - a.severity + randInt(-10,10));
    if(randInt(1,100) <= chance){
      a.health = Math.min(100, a.health + randInt(20,50)); a.treated = true; log('Leczenie powiod≈Ço siƒô ‚Äî '+a.name+' zdrowie: '+a.health+'%');
    } else { a.health = Math.max(1, a.health - randInt(5,20)); log('Leczenie nie powiod≈Ço siƒô ‚Äî komplikacje.'); }
    updateUI(); renderAnimals(); renderApplicants(); renderDetail(a);
  }

  window.markForAdoption = function(id){
    const a = animals.find(x=>x.id==id); if(!a) return; a.readyForAdoption = true; log(a.name+' gotowy do adopcji'); renderAnimals(); renderApplicants();
  }

  function updateAvgHealthBar(){
    const inS = animals.filter(x=>x.inShelter && !x.adopted);
    if(inS.length===0){ document.getElementById('avgHealth').style.width='4%'; return; }
    const avg = Math.floor(inS.reduce((s,x)=>s+x.health,0)/inS.length);
    document.getElementById('avgHealth').style.width = Math.max(4,avg)+'%';
    document.getElementById('avgHealth').style.background = avg>60? 'var(--good)': (avg>30? 'orange':'var(--danger)');
  }

  function updateUI(){
    document.getElementById('budget').innerText = budget+' z≈Ç';
    document.getElementById('rep').innerText = reputation;
    document.getElementById('day').innerText = day;
    updateAvgHealthBar();
  }

  // day tick: costs, events
  function nextDay(){
    day++;
    // shelter upkeep
    const upkeep = Math.max(0, animals.filter(x=>x.inShelter && !x.adopted).length * 10);
    budget -= upkeep;
    // random event: new call or applicant
    if(Math.random()<0.6) pushNewCall();
    if(Math.random()<0.4 && animals.some(x=>x.inShelter && !x.adopted)) applicants.push(genApplicantFor());
    // small health degradation for untreated severe animals
    animals.forEach(a=>{ if(a.inShelter && !a.treated){ a.health = Math.max(1, a.health - Math.floor(a.severity/25)); } });
    // reputation drift
    reputation = Math.max(0, reputation - Math.floor(Math.random()*2));
    // bankruptcy check
    if(budget< -200){ log('UWAGA: brak ≈õrodk√≥w! Schronisko nie przetrwa d≈Çugo.'); }
    updateUI(); renderAnimals(); renderApplicants();
  }

  document.getElementById('nextDay').addEventListener('click', nextDay);
  document.getElementById('callRescue').addEventListener('click', pushNewCall);

  // seed
  for(let i=0;i<2;i++) pushNewCall(); updateUI(); renderApplicants();

  // expose for debugging
  window._data = {animals,applicants};
    // ----- save / load -----
  function saveGame() {
    const data = { animals, applicants, day, budget, reputation };
    localStorage.setItem("shelterSave", JSON.stringify(data));
    showSaveIndicator();
  }

  function loadGame() {
    const raw = localStorage.getItem("shelterSave");
    if (!raw) return false;
    try {
      const data = JSON.parse(raw);
      if (!data) return false;
      animals.length = 0;
      applicants.length = 0;
      Object.assign(animals, data.animals);
      Object.assign(applicants, data.applicants);
      day = data.day;
      budget = data.budget;
      reputation = data.reputation;
      updateUI();
      renderAnimals();
      renderApplicants();
      log("Za≈Çadowano zapis gry.");
      return true;
    } catch (e) {
      console.error(e);
      return false;
    }
  }

  // auto save co 30 sekund + przy ka≈ºdej akcji
  setInterval(saveGame, 30000);
  document.addEventListener("click", e => {
    if (e.target.tagName === "BUTTON") saveGame();
  });

  // po starcie: spr√≥buj wczytaƒá zapis
  window.addEventListener("load", () => {
    const loaded = loadGame();
    if (!loaded) log("Nowa gra rozpoczƒôta.");
  });

  // ma≈Çy wska≈∫nik zapisu
  function showSaveIndicator() {
    let el = document.getElementById("saveIndicator");
    if (!el) {
      el = document.createElement("div");
      el.id = "saveIndicator";
      el.style.cssText = "position:fixed;bottom:10px;right:12px;font-size:12px;color:#999;background:#0006;padding:4px 8px;border-radius:6px";
      document.body.appendChild(el);
    }
    el.textContent = "üíæ Zapisano";
    el.style.opacity = "1";
    setTimeout(() => el.style.opacity = "0.3", 1500);
  }
  

})();
</script>
  <style>
    

#saveIndicator {
  transition: opacity 0.6s;
}
</style>

</body>
</html>
